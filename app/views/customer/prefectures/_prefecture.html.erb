<h3><%= @customer.prefecture.name %></h3>
<div id="weather"></div>

<script>
  $(function () {
    const API_KEY = "#{ENV['OPEN_WEATHER_MAP_API']}";
    // const latitude = "#{@customer.prefecture.latitude}";
    // const longitude = "#{@customer.prefecture.longitude}";
    const city = "#{@customer.prefecture.name_prefecture}";
    const url = 'https://api.openweathermap.org/data/2.5/weather?q=' + city + ',jp&units=metric&APPID=' + API_KEY;
    // const url = 'https://api.openweathermap.org/data/2.5/weather?lat=' + latitude + '&lon=' + longitude + '&appid=' + API_KEY;

    $.ajax({
        url: url,
        dataType: 'json',
        type: 'GET',
      })
    .done(function (data) {
      var insertHTML = '';
      var cityName = data.city.name;
      $('#city-name').html(cityName);

      for (var i = 0; i <= 32; i = i + 8) {
        insertHTML += buildHTML(data, i);
    }
      $('#weather').html(insertHTML);
    })
    .fail(function (data) {
      alert('天気予報取得に失敗しました');
    });
  });

  //language(jp)
  function buildHTML(data, i) {
    var date = new Date(data.daily[i].dt * 1000);
    date.setHours(date.getHours() + 9);
    var month = date.getMonth() + 1;
    var Week = new Array('(日)', '(月)', '(火)', '(水)', '(木)', '(金)', '(土)');
    var day = month + '/' + date.getDate() + Week[date.getDay()];
    var icon = data.daily[i].weather[0].icon;
    var html =
      '<div class="weather__content--report">' +
        '<img src="https://openweathermap.org/img/w/' + icon + '.png">' +
        '<span class="weather__content--report-date">' + day + "</span>" +
        '<div class="weather__content--report-temp-max">' + '最高：' + Math.round(data.daily[i].temp.max) + "℃</div>" +
        '<span class="weather__content--report-temp-min">' + '最低：' + Math.floor(data.daily[i].temp.min) + "℃</span>" +
      '</div>';
    return html
  }
</script>
